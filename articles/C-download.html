<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3. Data Download • dataverse</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="3. Data Download">
<meta property="og:description" content="dataverse">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dataverse</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/A-introduction.html">1. Introduction to Dataverse</a>
    </li>
    <li>
      <a href="../articles/B-search.html">2. Data Search and Discovery</a>
    </li>
    <li>
      <a href="../articles/C-download.html">3. Data Download</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/iqss/dataverse-client-r/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="C-download_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>3. Data Download</h1>
            
            <h4 class="date">2021-04-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/iqss/dataverse-client-r/blob/master/vignettes/C-download.Rmd"><code>vignettes/C-download.Rmd</code></a></small>
      <div class="hidden name"><code>C-download.Rmd</code></div>

    </div>

    
    
<p>This vignette shows how to download data from Dataverse using the dataverse package. We’ll focus on a Dataverse repository that contains supplemental files for <a href="https://www.springer.com/gb/book/9783319234458"><em>Political Analysis Using R</em></a>, which is stored at Harvard’s Dataverse Server <a href="https://dataverse.harvard.edu" class="uri">https://dataverse.harvard.edu</a>.</p>
<p>The Dataverse entry for this study is persistently retrievable by a “Digital Object Identifier (DOI)”: <a href="https://doi.org/10.7910/DVN/ARKOTI" class="uri">https://doi.org/10.7910/DVN/ARKOTI</a> and the citation on the Dataverse Page includes a “<a href="https://guides.dataverse.org/en/latest/developers/unf/index.html">Universal Numeric Fingerprint (UNF)</a>”: <code>UNF:6:+itU9hcUJ8I9E0Kqv8HWHg==</code>, which provides a versioned, multi-file hash for the entire study, which contains 32 files.</p>
<div id="retrieving-metadata" class="section level2">
<h2 class="hasAnchor">
<a href="#retrieving-metadata" class="anchor"></a>Retrieving Metadata</h2>
<p>We will download these files and examine them directly in R using the <strong>dataverse</strong> package. To begin, we need to loading the package and using the <code><a href="../reference/get_dataset.html">get_dataset()</a></code> function to retrieve some basic metadata about the dataset:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://iqss.github.io/dataverse-client-r/">"dataverse"</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span><span class="op">(</span><span class="st">"DATAVERSE_SERVER"</span> <span class="op">=</span> <span class="st">"dataverse.harvard.edu"</span><span class="op">)</span></code></pre></div>
<p>The <code><a href="../reference/get_dataset.html">get_dataset()</a></code> function lists all of the files in the dataset along with a considerable amount of metadata about each. (Recall that in Dataverse, <code>dataset</code> is a collection of files, not a single file.) We can see a quick glance at these files using:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_dataset.html">get_dataset</a></span><span class="op">(</span><span class="st">"doi:10.7910/DVN/ARKOTI"</span><span class="op">)</span>
<span class="va">dataset</span><span class="op">$</span><span class="va">files</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"filename"</span>, <span class="st">"contentType"</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<p>This shows that there are indeed 32 files, a mix of .R code files and tab- and comma-separated data files.</p>
<p>You can also retrieve more extensive metadata using <code><a href="../reference/get_dataset.html">dataset_metadata()</a></code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_dataset.html">dataset_metadata</a></span><span class="op">(</span><span class="st">"10.7910/DVN/ARKOTI"</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code>## List of 2
##  $ displayName: chr "Citation Metadata"
##  $ fields     :'data.frame': 7 obs. of  4 variables:
##   ..$ typeName : chr [1:7] "title" "author" "datasetContact" "dsDescription" ...
##   ..$ multiple : logi [1:7] FALSE TRUE TRUE TRUE TRUE FALSE ...
##   ..$ typeClass: chr [1:7] "primitive" "compound" "compound" "compound" ...
##   ..$ value    :List of 7</code></pre>
</div>
<div id="retrieving-plain-text-data" class="section level2">
<h2 class="hasAnchor">
<a href="#retrieving-plain-text-data" class="anchor"></a>Retrieving Plain-Text Data</h2>
<p>Now we’ll get the corresponding data files. First, we retrieve a plain-text file like this dataset on electricity consumption by <a href="https://doi.org/10.7910/DVN/ARKOTI/GN1MRT">Wakiyama et al. (2014)</a>. Taking the file name and dataset DOI from this entry,</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">energy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_dataframe_by_name.html">get_dataframe_by_name</a></span><span class="op">(</span>
  <span class="st">"comprehensiveJapanEnergy.tab"</span>,
  <span class="st">"10.7910/DVN/ARKOTI"</span><span class="op">)</span></code></pre></div>
<pre><code>## Downloading ingested version of data with readr::read_tsv. To download the original version and remove this message, set original = TRUE.</code></pre>
<pre><code>## 
## ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────
## cols(
##   time = col_double(),
##   date = col_character(),
##   dummy = col_double(),
##   temp = col_double(),
##   temp2 = col_double(),
##   all = col_double(),
##   large = col_double(),
##   house = col_double(),
##   kepco = col_double(),
##   tepco = col_double()
## )</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">energy</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 10
##    time date  dummy  temp temp2      all    large    house    kepco    tepco
##   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1     1 8-Jan     0   5.9  34.8 95792389 35194957 26190714 13357735 26960899
## 2     2 8-Feb     0   5.5  30.3 95156901 35322031 24224097 13315027 27189705
## 3     3 8-Mar     0  10.7 114.  91034047 36474192 21391965 12805831 24495519
## 4     4 8-Apr     0  14.7 216.  84087552 34949622 18494473 11494328 23540356
## 5     5 8-May     0  18.5 342.  82742929 35417089 17923760 11589061 22848737
## 6     6 8-Jun     0  21.3 454.  82180013 36692291 15205229 11360771 22487441</code></pre>
<p>These <code>get_dataframe_*</code> functions, introduced in v0.3.0, directly read in the data into a R environment through whatever R function supplied by <code>.f</code>. The default of the <code>get_dataframe_*</code> functions is to read in such data by <code><a href="https://readr.tidyverse.org/reference/read_delim.html">readr::read_tsv()</a></code>. The <code>.f</code> function can be modified to modify the read-in settings. For example, the following modification is a base-R equivalent to read in the ingested data.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span>
<span class="va">energy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_dataframe_by_name.html">get_dataframe_by_name</a></span><span class="op">(</span>
  <span class="st">"comprehensiveJapanEnergy.tab"</span>,
  <span class="st">"10.7910/DVN/ARKOTI"</span>,
  .f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.delim</a></span><span class="op">(</span><span class="va">x</span>, sep <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">energy</span><span class="op">)</span></code></pre></div>
<pre><code>##   time  date dummy temp temp2      all    large    house    kepco    tepco
## 1    1 8-Jan     0  5.9  34.8 95792389 35194957 26190714 13357735 26960899
## 2    2 8-Feb     0  5.5  30.3 95156901 35322031 24224097 13315027 27189705
## 3    3 8-Mar     0 10.7 114.5 91034047 36474192 21391965 12805831 24495519
## 4    4 8-Apr     0 14.7 216.1 84087552 34949622 18494473 11494328 23540356
## 5    5 8-May     0 18.5 342.3 82742929 35417089 17923760 11589061 22848737
## 6    6 8-Jun     0 21.3 453.7 82180013 36692291 15205229 11360771 22487441</code></pre>
</div>
<div id="retrieving-custom-data-fromats-rds-stata-spss" class="section level2">
<h2 class="hasAnchor">
<a href="#retrieving-custom-data-fromats-rds-stata-spss" class="anchor"></a>Retrieving Custom Data Fromats (RDS, Stata, SPSS)</h2>
<p>If a file is displayed on dataverse as a <code>.tab</code> file like the survey data by <a href="https://doi.org/10.7910/DVN/ARKOTI/A8YRMP">Alvarez et al. (2013)</a>, it is likely that Dataverse <a href="https://guides.dataverse.org/en/latest/user/tabulardataingest/index.html">ingested</a> the file to a plain-text, tab-delimited format.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">argentina_tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_dataframe_by_name.html">get_dataframe_by_name</a></span><span class="op">(</span>
  <span class="st">"alpl2013.tab"</span>,
  <span class="st">"10.7910/DVN/ARKOTI"</span><span class="op">)</span></code></pre></div>
<p>However, ingested files may not retain important dataset attributes. For example, Stata and SPSS datasets encode value labels on to numeric values. Factor variables in R dataframes encode levels, not only labels. A plain-text ingested file will discard such information. For example, the <code>polling_place</code> variable in this data is only given by numbers, although the original data labelled these numbers with informative values.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">argentina_tab</span><span class="op">$</span><span class="va">polling_place</span><span class="op">)</span></code></pre></div>
<pre><code>##  num [1:1475] 31 31 31 31 31 31 31 31 31 31 ...</code></pre>
<p>When ingesting, Dataverse retains a <code>original</code> version that retains these attributes but may not be readable in some platforms. The <code>get_dataframe_*</code> functions have an argument that can be set to <code>original = TRUE</code>. In this case we know that <code>alpl2013.tab</code> was originally a Stata dta file, so we can run:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">argentina_dta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_dataframe_by_name.html">get_dataframe_by_name</a></span><span class="op">(</span>
  <span class="st">"alpl2013.tab"</span>,
  <span class="st">"10.7910/DVN/ARKOTI"</span>,
  original <span class="op">=</span> <span class="cn">TRUE</span>,
  .f <span class="op">=</span> <span class="fu">haven</span><span class="fu">::</span><span class="va"><a href="https://haven.tidyverse.org/reference/read_dta.html">read_dta</a></span><span class="op">)</span></code></pre></div>
<p>Now we see that labels are read in through <code>haven</code>’s labelled variables class:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">argentina_dta</span><span class="op">$</span><span class="va">polling_place</span><span class="op">)</span></code></pre></div>
<pre><code>##  dbl+lbl [1:1475] 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 3...
##  @ label       : chr "polling_place"
##  @ format.stata: chr "%9.0g"
##  @ labels      : Named num [1:37] 1 2 3 4 5 6 7 8 9 10 ...
##   ..- attr(*, "names")= chr [1:37] "E.E.T." "Escuela Juan Bautista Alberdi" "Escuela Juan Carlos DÃ¡valos" "Escuela Bernardino de Rivadavia" ...</code></pre>
<p>Users should pick <code>.f</code> and <code>original</code> based on their existing knowledge of the file. If the original file is a <code>.sav</code> SPSS file, <code>.f</code> can be <code><a href="https://haven.tidyverse.org/reference/read_spss.html">haven::read_sav</a></code>. If it is a <code>.Rds</code> file, use <code>readRDS</code> or <code><a href="https://readr.tidyverse.org/reference/read_rds.html">readr::read_rds</a></code>. In fact, because the raw data is read in as a binary, there is no limitation to the file types <code>get_dataframe_*</code> can read in, as far as the dataverse package is concerned.</p>
<p>There are two more ways to read in a dataframe other than <code><a href="../reference/get_dataframe_by_name.html">get_dataframe_by_name()</a></code>. <code><a href="../reference/get_dataframe_by_name.html">get_dataframe_by_doi()</a></code> takes in a file-specific DOI if Dataverse contains one such as <a href="https://doi.org/10.7910/DVN/ARKOTI/IJPVOI" class="uri">https://doi.org/10.7910/DVN/ARKOTI/IJPVOI</a>. This removes the necessity for users to set the <code>dataset</code> argument. <code><a href="../reference/get_dataframe_by_name.html">get_dataframe_by_id()</a></code> takes a numeric Dataverse identification number. This identifier is an internal number and is not prominently featured in the interface.</p>
<p>In addition to visual inspection, we can compare the UNF signatures for each dataset against what is reported by Dataverse to confirm that we received the correct files. (See the <a href="https://cran.r-project.org/package=UNF">UNF package</a> and <code>unf</code> function).</p>
</div>
<div id="retrieving-scripts-and-other-files" class="section level2">
<h2 class="hasAnchor">
<a href="#retrieving-scripts-and-other-files" class="anchor"></a>Retrieving Scripts and other files</h2>
<p>If the file you want to retrieve is not data, you may want to use the more primitive function, <code>get_file</code>, which gets the file data as a raw binary file. See the help page examples of <code><a href="../reference/get_file.html">get_file()</a></code> that use the <code><a href="https://rdrr.io/r/base/readBin.html">base::writeBin()</a></code> function for details on how to write and read these binary files instead.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">code3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_file.html">get_file</a></span><span class="op">(</span><span class="st">"chapter03.R"</span>, <span class="st">"doi:10.7910/DVN/ARKOTI"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readBin.html">writeBin</a></span><span class="op">(</span><span class="va">code3</span>, <span class="st">"chapter03.R"</span><span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Will Beasley, Thomas J. Leeper, Shiro Kuriwaki, Philip Durbin, Sebastian Karcher.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
